---
title: 配置反恶意软件策略
f1.keywords:
- NOCSH
ms.author: chrisda
author: chrisda
manager: dansimp
ms.date: ''
audience: ITPro
ms.topic: how-to
ms.localizationpriority: medium
search.appverid:
- MET150
ms.assetid: b0cfc21f-e3c6-41b6-8670-feb2b2e252e5
ms.collection:
- M365-security-compliance
- m365initiative-defender-office365
description: 管理员可以了解如何在 EOP 管理中心中查看、创建、修改和删除Exchange Online Protection () 。
ms.custom: seo-marvel-apr2020
ms.technology: mdo
ms.prod: m365-security
ms.openlocfilehash: bd52bc73199845fe06b2cbe7c9ab4c23f5247c44
ms.sourcegitcommit: 7b83e2605895fee5c73cd1d01f4cd16e1457a69f
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/11/2021
ms.locfileid: "60907977"
---
# <a name="configure-anti-malware-policies-in-eop"></a>在 EOP 中配置反恶意软件策略

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender-for-office.md)]

**适用对象**
- [Exchange Online Protection](exchange-online-protection-overview.md)
- [Microsoft Defender for Office 365 计划 1 和计划 2](defender-for-office-365.md)
- [Microsoft 365 Defender](../defender/microsoft-365-defender.md)

在Microsoft 365邮箱位于 Exchange Online 或独立 Exchange Online Protection (EOP) 组织中Exchange Online，EOP 会自动保护电子邮件免受恶意软件的攻击。 EOP 使用反恶意软件策略进行恶意软件保护设置。 有关详细信息，请参阅 [反恶意软件保护](anti-malware-protection.md)。

管理员可以查看、编辑和配置 (但不能删除) 默认反恶意软件策略以满足其组织的需要。 更精细地来说，您还可以创建适用于组织中特定用户、组或域的自定义反恶意软件策略。 自定义策略始终优先于默认策略，但可以更改自定义策略的优先级（即运行顺序）。

您可以在 Microsoft 365 Defender 门户中或在 PowerShell (Exchange Online PowerShell 中为Microsoft 365邮箱的组织配置反恶意软件Exchange Online;适用于没有邮箱或邮箱Exchange Online的独立 EOP PowerShell) 。

## <a name="what-do-you-need-to-know-before-you-begin"></a>开始前，有必要了解什么？

- 访问 <https://security.microsoft.com> 打开 Microsoft 365 Defender 门户。 若要直接转到 **反恶意软件页面，** 请使用 <https://security.microsoft.com/antimalwarev2> 。

- 若要连接到 Exchange Online PowerShell，请参阅[连接到 Exchange Online PowerShell](/powershell/exchange/connect-to-exchange-online-powershell)。 若要连接到独立 EOP PowerShell，请参阅[连接到 Exchange Online Protection PowerShell](/powershell/exchange/connect-to-exchange-online-protection-powershell)。

- 在 Exchange Online 网站中 **分配** 权限，才能执行本文中的步骤：
  - 若要添加、修改和删除反恶意软件策略，您必须是组织管理或 **安全管理员角色组** 的成员。
  - 若要对反恶意软件策略进行只读访问，你需要是全局读者或安全读者 **角色组** 的成员。

  有关详细信息，请参阅 [Exchange Online 中权限](/exchange/permissions-exo/permissions-exo)。

  **注意**：

  - 在 Microsoft 365 管理中心将用户添加到相应的 Azure Active Directory 角色后，将为用户提供所需的权限 _和_ Microsoft 365 中其他功能的权限。有关详细信息，请参阅 [关于管理员角色](../../admin/add-users/about-admin-roles.md)。
  - [Exchange Online](/Exchange/permissions-exo/permissions-exo#role-groups) 中的 **仅查看组织管理人员** 角色组也提供到该功能的只读访问。

- 有关建议的反恶意软件策略设置，请参阅 [EOP 反恶意软件策略设置](recommended-settings-for-eop-and-office365.md#eop-anti-malware-policy-settings)。

## <a name="use-the-microsoft-365-defender-portal-to-create-anti-malware-policies"></a>使用Microsoft 365 Defender门户创建反恶意软件策略

在门户中创建自定义反恶意软件策略Microsoft 365 Defender使用相同的名称同时创建恶意软件筛选器规则和相关恶意软件筛选器策略。

1. 在 Microsoft 365 Defender 门户中，转到"策略"&中的"电子邮件&协作策略""规则威胁策略 \>  \>  \> **""** 反恶意软件"。 

2. 在" **反恶意软件"页上** ，单击" ![ 创建图标"。](../../media/m365-cc-sc-create-icon.png) **Create**。

3. 将打开策略向导。 在" **命名策略"页上** ，配置以下设置：
   - **名称**：输入策略的唯一描述性名称。
   - **说明**：输入策略的可选说明。

   完成后，单击“**下一步**”。

4. 在 **出现的"用户** 和域"页上，标识策略应用于以下收件人 (内部) ：
   - **用户**：你的组织内指定的邮箱、邮件用户或邮件联系人。
   - **组**：你的组织内指定的通讯组、启用邮件的安全组或 Microsoft 365 组。
   - **域**：你的组织内指定的 [接受域](/exchange/mail-flow-best-practices/manage-accepted-domains/manage-accepted-domains)中的所有收件人。

   单击相应的框，开始键入值，然后从结果中选择所需的值。 根据需要多次重复此过程。 若要删除现有值，请单击值旁边的 ![删除图标。](../../media/m365-cc-sc-remove-selection-icon.png) “删除”。

   对于用户或组，可以使用大多数标识符（名称、显示名称、别名、电子邮件地址、帐户名称等），但相应的显示名称则显示在结果中。对于用户，请自行输入星号（\*），以查看所有可用值。

   同一个条件的多个值使用 OR 逻辑（例如，_\<recipient1\>_ 或 _\<recipient2\>_）。 不同的条件使用 AND 逻辑（例如，_\<recipient1\>_ 和 _\<member of group 1\>_）。

   - **排除这些用户、组和域**：若要为策略应用于的内部收件人添加例外（收件人例外），请选择此选项并配置例外。 设置和行为与条件完全相同。

   完成后，单击“**下一步**”。

5. 在出现的 **"** 保护设置"页上，配置以下设置：

   - **启用常见附件筛选器**：如果选择此选项，带指定附件的邮件将被视为恶意软件并自动隔离。 可以通过选择"自定义文件类型" **来修改默认列表**。

   - **启用恶意软件的零时差** 自动清除：如果选择此选项，ZAP 将隔离已传递的恶意软件邮件。 有关详细信息，请参阅 EXCHANGE ONLINE 中的零[时差自动清除 (ZAP) 。](zero-hour-auto-purge.md) 选择以下值之一：

   - **隔离策略**：选择适用于被隔离为恶意软件的邮件的隔离策略。 隔离策略定义用户可以对隔离邮件执行哪些操作，以及用户是否收到隔离通知。 有关详细信息，请参阅 [隔离策略](quarantine-policies.md)。

     空值表示将默认隔离策略 (AdminOnlyAccessPolicy 进行恶意软件) 。 以后编辑反恶意软件策略或查看设置时，将显示默认隔离策略名称。 有关用于受支持的保护筛选裁定的默认隔离策略详细信息，请参阅 [此表](quarantine-policies.md#step-2-assign-a-quarantine-policy-to-supported-features)。

   - **当邮件被隔离为恶意软件时通知收件人**：
     - 如果选择此选项，则隔离邮件。 邮件的副本会传递给收件人，但所有附件 (恶意软件附件) 都替换为名为 Malware Alert Text.txt的 **单个文本文件**。

       替换文本文件中的默认文本在 [反恶意软件策略中介绍](anti-malware-protection.md#anti-malware-policies)。 若要改为使用自定义文本，请在"发送给收件人的 **自定义通知文本"框中输入** 文本。

     - 如果不选择此选项，则以静默方式隔离邮件。

     > [!NOTE]
     > 无论选择何种选项，隔离策略都会确定收件人是否收到隔离通知 (作为恶意软件邮件隔离的邮件) 。

   - **发件人通知**：选择无、一个或两个选项：
       - **将邮件隔离为恶意软件时** 通知内部发件人：内部发件人在组织内部。
       - **将邮件隔离为恶意软件** 时通知外部发件人：外部发件人在组织外部。

   - **管理员通知**：选择无、一个或两个选项：
       - **通知管理员有关** 来自内部发件人的未送达邮件：如果选择此选项，请在出现的"管理员电子邮件地址"框中输入通知电子邮件地址。 
       - **通知管理员有关** 来自外部发件人的未送达邮件：如果选择此选项，请在出现的"管理员电子邮件地址"框中输入通知电子邮件地址。 

   - **自定义通知**：这些设置将替换用于发件人或管理员的默认通知文本。 有关默认值详细信息，请参阅 [反恶意软件策略](anti-malware-protection.md#anti-malware-policies)。
       - **使用自定义** 通知文本：如果选择此选项，则需要使用"发件人姓名"和"发件人地址"框指定自定义通知邮件中使用的发件人姓名和电子邮件地址。
       - 自定义来自内部发件人的邮件通知：如果选择向发件人或管理员通知来自内部发件人的未送达邮件，则需要使用"主题"和"邮件"框指定自定义通知邮件的主题和邮件正文。 
       - 自定义来自外部发件人的邮件的通知：如果选择向发件人或管理员通知来自外部发件人的未送达邮件，则需要使用"主题"和"邮件"框指定自定义通知邮件的主题和邮件正文。 

   完成后，单击“**下一步**”。

6. 在出现的“**审阅**”页面上，查看你的设置。 可以在每个部分中选择“**编辑**”来修改该部分中的设置。 或者，可以单击“**返回**”或选择向导中的特定页面。

   完成后，请单击“**提交**”。

7. 在出现的确认页面上，单击“**完成**”。

## <a name="use-the-microsoft-365-defender-portal-to-view-anti-malware-policies"></a>使用Microsoft 365 Defender门户查看反恶意软件策略

1. 在 Microsoft 365 Defender 门户中，转到"策略"&中的"电子邮件&协作策略""规则威胁策略 \>  \>  \> **""** 反恶意软件"。 

2. 在 **"反恶意软件"** 页上，反恶意软件策略列表中将显示以下属性：
   - **名称**
   - **状态**
   - **优先级**

3. 当您通过单击该名称选择策略时，策略设置将显示在一个飞出内容中。

## <a name="use-the-microsoft-365-defender-portal-to-modify-anti-malware-policies"></a>使用Microsoft 365 Defender门户修改反恶意软件策略

1. 在 Microsoft 365 Defender 门户中，转到"策略"&中的"电子邮件&协作策略""规则威胁策略 \>  \>  \> **""** 反恶意软件"。 

2. 在 **"反恶意软件"** 页上，通过单击名称从列表中选择策略。

3. 在出现的策略详细信息浮出控件中，选择每个部分中的“**编辑**”以修改该部分中的设置。 有关设置详细信息，请参阅本文前面的使用 Microsoft 365 Defender 门户创建[反恶意软件](#use-the-microsoft-365-defender-portal-to-create-anti-malware-policies)策略部分。

   对于默认的反恶意软件策略，"用户、组和域"部分不可用 (该策略适用于所有用户) ，并且无法重命名该策略。

若要启用或禁用策略或设置策略优先级顺序，请参阅以下几节。

### <a name="enable-or-disable-custom-anti-malware-policies"></a>启用或禁用自定义反恶意软件策略

无法禁用默认的反恶意软件策略。

1. 在 Microsoft 365 Defender 门户中，转到"策略"&中的"电子邮件&协作策略""规则威胁策略 \>  \>  \> **""** 反恶意软件"。 

2. 在 **"反恶意软件"** 页上，通过单击该名称从列表中选择自定义策略。

3. 在出现的策略详细信息浮出控件顶部，你将看到以下值之一：
   - **策略关闭**：若要打开策略，请单击![“打开”图标。](../../media/m365-cc-sc-turn-on-off-icon.png)**“打开”**。
   - **策略打开**：若要关闭策略，请单击![“关闭”图标。](../../media/m365-cc-sc-turn-on-off-icon.png)**“关闭”**。

4. 在出现的确认对话框中，单击“**打开**”或“**关闭**”。

5. 单击策略详细信息浮出控件中的“**关闭**”。

返回主策略页面，策略的“**状态**”值将为“**打开**”或“**关闭**”。

### <a name="set-the-priority-of-custom-anti-malware-policies"></a>设置自定义反恶意软件策略的优先级

默认情况下，根据反恶意软件策略在 (中的创建顺序，反恶意软件策略的优先级低于较旧策略) 。 低优先级数字表示高策略优先级（0 是最高优先级），且策略按照优先级顺序进行处理（高优先级策略先处理，低优先级策略后处理）。 没有两个策略可以具有相同的优先级，并且在应用第一个策略之后，策略处理将停止。

要更改策略的优先级，请在策略属性中单击“**提高优先级**”或“**降低优先级**”（不能在 Microsoft 365 Defender 门户中直接修改 **优先级** 编号）。仅当具有多个策略时，更改策略的优先级才有意义。

 **注意**：

- 在Microsoft 365 Defender门户中，只能在创建反恶意软件策略后更改该策略的优先级。 在 PowerShell 中，可以在创建可影响现有规则优先级的恶意软件筛选器规则 (替代默认优先级) 。
- 反恶意软件策略按照第一个策略的优先级值为 0 (的显示顺序进行处理) 。  默认反恶意软件策略的优先级值为 **Lowest**，你无法更改它。

1. 在 Microsoft 365 Defender 门户中，转到"策略"&中的"电子邮件&协作策略""规则威胁策略 \>  \>  \> **""** 反恶意软件"。 

2. 在 **"反恶意软件"** 页上，通过单击该名称从列表中选择自定义策略。

3. 在出现的策略详细信息浮出控件顶部，你会看到“**提高优先级**”或“**降低优先级**”，具体取决于当前优先级值和自定义策略数量：
   - 优先级值为 **0** **的策略** 只有"**减少优先级"** 选项可用。
   - 优先级值最低的 **策略 (例如****，3**) 只有"增加优先级 **"** 选项可用。
   - 如果你有三个或多个策略，则最高优先级值和最低优先级值之间的策略同时具有"增加 **优先级** "和" **减少优先级"** 选项。

   单击![“提高优先级”图标。](../../media/m365-cc-sc-increase-icon.png) **“提高优先级”** 或![“降低优先级”图标](../../media/m365-cc-sc-decrease-icon.png) **“降低优先级”** 以更改 **“优先级”** 值。

4. 完成后，单击策略详细信息浮出控件中的“**关闭**”。

## <a name="use-the-microsoft-365-defender-portal-to-remove-custom-anti-malware-policies"></a>使用 Microsoft 365 Defender门户删除自定义反恶意软件策略

使用自定义Microsoft 365 Defender删除自定义反恶意软件策略时，会同时删除恶意软件筛选器规则以及相应的恶意软件筛选器策略。 不能删除默认的反恶意软件策略。

1. 在 Microsoft 365 Defender 门户中，转到"策略"&中的"电子邮件&协作策略""规则威胁策略 \>  \>  \> **""** 反恶意软件"。 

2. 在 **"反恶意软件"页上**，通过单击名称从列表中选择自定义策略。

3. 在显示的策略详细信息浮出控件顶部，单击![更多操作图标。](../../media/m365-cc-sc-more-actions-icon.png) **更多操作** \> ![删除策略图标](../../media/m365-cc-sc-delete-icon.png) **删除策略**。

4. 在出现的确认对话框中，单击“**是**”。

## <a name="use-exchange-online-powershell-or-standalone-eop-powershell-to-configure-anti-malware-policies"></a>使用 Exchange Online PowerShell 或独立 EOP PowerShell 配置反恶意软件策略

有关 PowerShell 中的反垃圾邮件策略详细信息，请参阅 Microsoft 365 Defender[门户与 PowerShell](anti-malware-protection.md#anti-malware-policies-in-the-microsoft-365-defender-portal-vs-powershell)中的反恶意软件策略。

### <a name="use-powershell-to-create-anti-malware-policies"></a>使用 PowerShell 创建反恶意软件策略

在 PowerShell 中创建反恶意软件策略的过程包含两个步骤：

1. 创建恶意软件筛选器策略。
2. 创建恶意软件筛选器规则，该规则指定该规则应用于的恶意软件筛选器策略。

 **注意**：

- 你可以创建新的恶意软件筛选器规则，并为其分配现有的未关联的恶意软件筛选器策略。 恶意软件筛选器规则不能与多个恶意软件筛选器策略关联。
- 可以在 PowerShell 中的新反恶意软件策略上配置两个设置，这些设置在创建新策略Microsoft 365 Defender后才能在 Microsoft 365 Defender 门户中可用：
  - 在 `$false` **New-MalwareFilterRule** cmdlet (上创建禁用的新策略) 。
  - 在 _\<Number\>_ **New-MalwareFilterRule** cmdlet cmdlet (中) 策略的优先级) 。
- 在 PowerShell 中新建的恶意软件筛选器策略在 Microsoft 365 Defender门户中不可见，除非将策略分配给恶意软件筛选器规则。

#### <a name="step-1-use-powershell-to-create-a-malware-filter-policy"></a>步骤 1：使用 PowerShell 创建恶意软件筛选器策略

**注意**：在基于云的服务中 _，Action_ 参数值 、 和 `DeleteMessage` `DeleteAttachmentAndUseDefaultAlert` `DeleteAttachmentAndUseCustomAlert` 不删除消息。 相反，邮件始终被隔离。 有关检索隔离邮件的信息，请参阅在 EOP 中以管理员角色管理隔离的邮件 [和文件](manage-quarantined-messages-and-files.md)。

若要创建恶意软件筛选器策略，请使用以下语法：

```PowerShell
New-MalwareFilterPolicy -Name "<PolicyName>" [-Action <DeleteMessage | DeleteAttachmentAndUseDefaultAlert | DeleteAttachmentAndUseCustomAlert>] [-AdminDisplayName "<OptionalComments>"] [-CustomNotifications <$true | $false>] [<Inbound notification options>] [<Outbound notification options>] [-QuarantineTag <QuarantineTagName>]
```

此示例使用这些设置创建名为 Contoso Malware Filter Policy 的新恶意软件筛选器策略：

- 在不通知收件人的情况下隔离包含恶意软件 (我们未使用 _Action_ 参数，默认值为 `DeleteMessage`) 。
- 在邮件中检测到恶意软件时，不要通知邮件发件人 (我们未使用 _EnableExternalSenderNotifications_ 或 _EnableInternalSenderNotifications_ 参数，并且这两个参数的默认值为 `$false`) 。
- 当在内部发件人发送的邮件中检测到恶意软件时通知管理员 admin@contoso.com。
- 我们 [未在使用](quarantine-policies.md) _QuarantineTag_ 参数 (，则使用恶意软件检测的默认隔离) 。

```PowerShell
New-MalwareFilterPolicy -Name "Contoso Malware Filter Policy" -EnableInternalSenderAdminNotifications $true -InternalSenderAdminAddress admin@contoso.com
```

有关语法和参数的详细信息，请参阅 [New-MalwareFilterPolicy](/powershell/module/exchange/new-malwarefilterpolicy)。

#### <a name="step-2-use-powershell-to-create-a-malware-filter-rule"></a>步骤 2：使用 PowerShell 创建恶意软件筛选器规则

若要创建恶意软件筛选器规则，请使用以下语法：

```PowerShell
New-MalwareFilterRule -Name "<RuleName>" -MalwareFilterPolicy "<PolicyName>" <Recipient filters> [<Recipient filter exceptions>] [-Comments "<OptionalComments>"]
```

此示例使用这些设置创建名为 Contoso Recipients 的新恶意软件筛选器规则：

- 名为 Contoso Malware Filter Policy 的恶意软件筛选器策略与该规则关联。
- 该规则适用于域中 contoso.com 收件人。

```PowerShell
New-MalwareFilterRule -Name "Contoso Recipients" -MalwareFilterPolicy "Contoso Malware Filter Policy" -RecipientDomainIs contoso.com
```

有关语法和参数的详细信息，请参阅 [New-MalwareFilterRule](/powershell/module/exchange/new-malwarefilterrule)。

### <a name="use-powershell-to-view-malware-filter-policies"></a>使用 PowerShell 查看恶意软件筛选器策略

要返回所有恶意软件筛选器策略的摘要列表，请运行此命令：

```PowerShell
Get-MalwareFilterPolicy
```

要返回有关特定恶意软件筛选器策略的详细信息，请使用以下语法：

```PowerShell
Get-MalwareFilterPolicy -Identity "<PolicyName>" | Format-List [<Specific properties to view>]
```

本示例返回名为 Executives 的恶意软件筛选器策略的所有属性值。

```PowerShell
Get-MalwareFilterPolicy -Identity "Executives" | Format-List
```

此示例仅返回同一策略的指定属性。

```PowerShell
Get-MalwareFilterPolicy -Identity "Executives" | Format-List Action,AdminDisplayName,CustomNotifications,Enable*Notifications
```

有关语法和参数的详细信息，请参阅 [Get-MalwareFilterPolicy](/powershell/module/exchange/get-malwarefilterpolicy)。

### <a name="use-powershell-to-view-malware-filter-rules"></a>使用 PowerShell 查看恶意软件筛选器规则

若要返回所有恶意软件筛选器规则的摘要列表，请运行此命令：

```PowerShell
Get-MalwareFilterRule
```

若要按已启用或已禁用规则筛选列表，请运行以下命令：

```PowerShell
Get-MalwareFilterRule -State Disabled
```

```PowerShell
Get-MalwareFilterRule -State Enabled
```

要返回有关特定恶意软件筛选器规则的详细信息，请使用以下语法：

```PowerShell
Get-MalwareFilterRule -Identity "<RuleName>" | Format-List [<Specific properties to view>]
```

本示例返回名为 Executives 的恶意软件筛选器规则的所有属性值。

```PowerShell
Get-MalwareFilterRule -Identity "Executives" | Format-List
```

下面的示例仅返回同一规则的指定属性。

```PowerShell
Get-MalwareFilterRule -Identity "Executives" | Format-List Name,Priority,State,MalwareFilterPolicy,*Is,*SentTo,*MemberOf
```

有关语法和参数的详细信息，请参阅 [Get-MalwareFilterRule](/powershell/module/exchange/get-malwarefilterrule)。

### <a name="use-powershell-to-modify-malware-filter-policies"></a>使用 PowerShell 修改恶意软件筛选器策略

除了以下项目外，在 PowerShell 中修改恶意软件筛选器策略时可用的设置与创建策略时相同，如本文前面步骤 [1：使用 PowerShell](#step-1-use-powershell-to-create-a-malware-filter-policy) 创建恶意软件筛选器策略一节中所述。

- _MakeDefault_ 开关将指定策略转换为应用于所有人的默认策略 (，不可修改的最低优先级，并且你无法将其删除) 仅在在 PowerShell 中修改恶意软件筛选器策略时可用。
- You can't rename a malware filter policy (the **Set-MalwareFilterPolicy** cmdlet has no _Name_ parameter) . 在门户中重命名反恶意软件策略Microsoft 365 Defender，只需重命名恶意软件筛选器 _规则_。

若要修改恶意软件筛选器策略，请使用以下语法：

```PowerShell
Set-MalwareFilterPolicy -Identity "<PolicyName>" <Settings>
```

有关语法和参数的详细信息，请参阅 [Set-MalwareFilterPolicy](/powershell/module/exchange/set-malwarefilterpolicy)。

> [!NOTE]
> 有关指定在恶意软件筛选器策略[](quarantine-policies.md)中使用的隔离策略的详细说明，请参阅使用 PowerShell 在反恶意软件策略中[指定隔离策略](quarantine-policies.md#anti-malware-policies-in-powershell)。

### <a name="use-powershell-to-modify-malware-filter-rules"></a>使用 PowerShell 修改恶意软件筛选器规则

在 PowerShell 中修改恶意软件筛选器规则时，唯一不可用的设置是允许创建已禁用规则的 _Enabled_ 参数。 若要启用或禁用现有恶意软件筛选器规则，请参阅下一节。

否则，在 PowerShell 中修改恶意软件筛选器规则时，其他设置将不可用。 创建规则时可用的设置与本文前面步骤 [2：使用 PowerShell](#step-2-use-powershell-to-create-a-malware-filter-rule) 创建恶意软件筛选器规则一节中所述的设置相同。

若要修改恶意软件筛选器规则，请使用以下语法：

```PowerShell
Set-MalwareFilterRule -Identity "<RuleName>" <Settings>
```

有关语法和参数的详细信息，请参阅 [Set-MalwareFilterRule](/powershell/module/exchange/set-malwarefilterrule)。

### <a name="use-powershell-to-enable-or-disable-malware-filter-rules"></a>使用 PowerShell 启用或禁用恶意软件筛选器规则

在 PowerShell 中启用或禁用恶意软件筛选器规则会启用或禁用整个反恶意软件策略 (恶意软件筛选器规则以及分配的恶意软件筛选器策略) 。 无法启用或禁用默认反恶意软件策略 (它始终应用于所有收件人或) 。

若要在 PowerShell 中启用或禁用恶意软件筛选器规则，请使用以下语法：

```PowerShell
<Enable-MalwareFilterRule | Disable-MalwareFilterRule> -Identity "<RuleName>"
```

本示例禁用名为"Marketing Department"的恶意软件筛选器规则。

```PowerShell
Disable-MalwareFilterRule -Identity "Marketing Department"
```

下面的示例启用同一规则。

```PowerShell
Enable-MalwareFilterRule -Identity "Marketing Department"
```

有关语法和参数的详细信息，请参阅[Enable-MalwareFilterRule](/powershell/module/exchange/enable-malwarefilterrule)和[Disable-MalwareFilterRule。](/powershell/module/exchange/disable-malwarefilterrule)

### <a name="use-powershell-to-set-the-priority-of-malware-filter-rules"></a>使用 PowerShell 设置恶意软件筛选器规则的优先级

可以设置的规则最高优先级值是 0。可以设置的最小优先级值取决于规则的数量。例如，如果有五个规则，则可以使用的优先级值为 0 到 4。更改现有规则的优先级可对其他规则产生级联效应。例如，假设有五个自定义规则（优先级为 0 到 4），如果将某个规则的优先级更改为 2，则优先级为 2 的现有规则将更改为优先级 3，优先级为 3 的规则将更改为优先级 4。

若要在 PowerShell 中设置恶意软件筛选器规则的优先级，请使用以下语法：

```PowerShell
Set-MalwareFilterRule -Identity "<RuleName>" -Priority <Number>
```

此示例将名为"Marketing Department"规则的优先级设置为 2：具有小于或等于 2 优先级的所有现有规则的编号将递减 1（它们的优先级编号均递增 1）。

```PowerShell
Set-MalwareFilterRule -Identity "Marketing Department" -Priority 2
```

**注意**：

- 若要在创建新规则的优先级时设置该规则的优先级，请改为对 **New-MalwareFilterRule** cmdlet 使用 _Priority_ 参数。
- 默认恶意软件筛选器策略没有对应的恶意软件筛选器规则，并且始终具有不可修改的优先级值 **Lowest**。

### <a name="use-powershell-to-remove-malware-filter-policies"></a>使用 PowerShell 删除恶意软件筛选器策略

使用 PowerShell 删除恶意软件筛选器策略时，不会删除相应的恶意软件筛选器规则。

若要在 PowerShell 中删除恶意软件筛选器策略，请使用以下语法：

```PowerShell
Remove-MalwareFilterPolicy -Identity "<PolicyName>"
```

此示例删除名为 Marketing Department 的恶意软件筛选器策略。

```PowerShell
Remove-MalwareFilterPolicy -Identity "Marketing Department"
```

有关语法和参数的详细信息，请参阅 [Remove-MalwareFilterPolicy](/powershell/module/exchange/remove-malwarefilterpolicy)。

### <a name="use-powershell-to-remove-malware-filter-rules"></a>使用 PowerShell 删除恶意软件筛选器规则

使用 PowerShell 删除恶意软件筛选器规则时，不会删除相应的恶意软件筛选器策略。

若要在 PowerShell 中删除恶意软件筛选器规则，请使用以下语法：

```PowerShell
Remove-MalwareFilterRule -Identity "<PolicyName>"
```

本示例删除名为"Marketing Department"的恶意软件筛选器规则。

```PowerShell
Remove-MalwareFilterRule -Identity "Marketing Department"
```

有关语法和参数的详细信息，请参阅 [Remove-MalwareFilterRule](/powershell/module/exchange/remove-malwarefilterrule)。

## <a name="how-do-you-know-these-procedures-worked"></a>如何判断这些过程生效了？

### <a name="use-the-eicartxt-file-to-verify-your-anti-malware-policy-settings"></a>使用 EICAR.TXT 文件验证反恶意软件策略设置

> [!IMPORTANT]
> EICAR.TXT 文件不是病毒。 欧洲计算机防病毒研究 (EICAR) 开发了此文件以安全测试防病毒安装和设置。

1. 打开记事本，然后将以下文本粘贴到空文件中：

   ```Text
   X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*
   ```

   请确保这些是文件中唯一的文本字符。 文件大小应为 68 字节。

2. 将文件另存为EICAR.TXT

   在桌面防病毒程序中，请确保将 EICAR.TXT从扫描 (，否则文件将被隔离) 。

3. 使用不会自动阻止文件的电子邮件客户端，以及使用不会自动阻止出站垃圾邮件的电子邮件服务，以附件形式发送包含 EICAR.TXT 文件的电子邮件。 使用反恶意软件策略设置确定要测试的以下方案：
   - 从内部邮箱向内部收件人发送电子邮件。
   - 从内部邮箱向外部收件人发送电子邮件。
   - 从外部邮箱向内部收件人发送电子邮件。

4. 验证邮件是否隔离，并基于反恶意软件策略设置验证收件人和发件人通知结果。 例如：
   - 不会通知收件人，或者收件人将收到原始邮件，EICAR.TXT附件替换为包含默认或自定义Text.txt恶意软件警报报告。 
   - 向内部发件人或外部发件人发送默认或自定义通知邮件。
   - 您指定的管理员电子邮件地址将通过默认或自定义的通知邮件通知内部或外部邮件发件人。

5. 在EICAR.TXT完成后删除文件， (其他用户不必为此而) 。
